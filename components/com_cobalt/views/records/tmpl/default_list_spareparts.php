<?phpdefined('_JEXEC') or die();JImport('b0.Sparepart.Spareparts');JFactory::getDocument()->addScript('/media/b0/js/jquery-ias.min.js');//$paramsList = $this->tmpl_params['list'];$spareparts = new Spareparts($this->items);//b0debug($spareparts);?><div id="articles" class="uk-margin-top">    <hr class="uk-article-didvider">    <?php foreach ($spareparts->items as $id => $item):?>        <article class="uk-article uk-visible-hover">            <!-- Панель управления -->			<?php if($item->controls){				echo JLayoutHelper::render('b0.controls-list', $item->controls);			}?>            <!-- Запчасть -->            <h2 class="uk-article-title uk-text-center-small">                <a href="<?= JRoute::_($item->url);?>" target="_blank">					<?= $item->title?>                </a>            </h2>            <div class="uk-grid uk-grid-match" data-uk-grid-margin data-uk-grid-match>                <div class="uk-width-medium-2-10 uk-text-center-small">					<?= $item->image;?>                </div>                <div class="uk-width-medium-4-10 uk-text-center-small">                    <ul class="uk-list">	                    <?php $spareparts->renderField('li','Модели', $item->models);?>	                    <?php $spareparts->renderField('li','Моторы', $item->motors);?>	                    <?php $spareparts->renderField('li','Производитель', $item->manufacturer);?>	                    <?php $spareparts->renderField('li','Код товара', $item->productCode);?>	                    <?php $spareparts->renderField('li','Артикул', $item->vendorCode);?>	                    <?php $spareparts->renderField('li','', $item->subtitle);?>                    </ul>                </div>                <div class="uk-width-medium-4-10 uk-text-center-small" data-uk-grid-match>                    <div class="uk-panel uk-panel-box uk-vertical-align-middle">                        <?php $spareparts->renderPrice($item);?>                        <!-- Корзина -->                        <div class="uk-grid">                            <div class="uk-width-medium-1-1">								<?php if (!$item->isByOrder): ?>                                    <div id="cart<?= $id;?>" class="uk-vertical-align-middle">                                        <input type="number" id="cart-quantity<?= $id;?>"											<?= !$item->isInCart ? 'min="1"' : 'min="0"';?>											<?= !$item->isInCart ? 'value="1"' : 'value="0"';?>                                               style="margin-bottom: auto; width: 50px;" />                                        <button type="button" class="cart-add" id="cart-add<?= $id;?>"                                                data-item-id = "<?= $id;?>"                                                data-in-cart="<?= $item->isInCart ? $item->isInCart : 0;?>">											<?= $item->isInCart ? 'Изменить' : '<i class="uk-icon-cart-plus uk-margin-right"></i>В корзину';?>                                        </button>                                        <a href="<?= JRoute::_('cart'); ?>">                                            <span id="cart-already<?= $id;?>" <?= (!$item->isInCart) ? "hidden" : "";?>>Сейчас в корзине                                            <span class="badge" style="font-size: 15px;" ><?= $item->cartQuantity;?></span></span>                                        </a>                                    </div>								<?php endif;?>                            </div>                        </div>                    </div>                </div>            </div>        </article>	<?php endforeach;?></div><div id="pagination-counter" class="uk-text-center uk-text-small uk-margin-top"></div><hr class="uk-article-divider"><div class="pagination uk-text-center">	<?= str_replace('<ul>', '<ul class="pagination-list">', $this->pagination->getPagesLinks());?></div><script>	// 'use strict';    let ias = jQuery.ias({        container:  "#articles",        item:       ".uk-article",        pagination: ".pagination",        next:       ".pagination-next a"    });    ias.extension(new IASSpinnerExtension({        html: '<div class="ias-spinner uk-text-center"><i class="uk-icon-refresh uk-icon-spin"></i></div>'    }));    ias.extension(new IASTriggerExtension({        text: 'Показать еще 10',        html: '<div class="ias-trigger ias-trigger-next uk-text-center"><a class="uk-button uk-button-primary">{text}</a></div>'    }));    ias.extension(new IASNoneLeftExtension({        text: 'Конец списка'    }));    ias.extension(new IASPagingExtension());    ias.on('rendered', function(items) {        let $items = $(items);        for (let i = 0; i < items.length; i++) {            items[i].addEventListener('click' , cartAdd);        }    });    ias.on('pageChange', function(pageNum, scrollOffset, url) {       document.getElementById('pagination-counter').textContent = 'Показано страниц: ' + pageNum + ' из ' + <?= $this->pagination->pagesTotal;?>;    });    let elem = document.getElementsByClassName('cart-add');	for (let i = 0; i < elem.length; i++) {		elem[i].addEventListener('click' , cartAdd);		elem[i].addEventListener('click' , yaCounter);	}	function cartAdd(event) {		let target = event.target;		//Получаем значения ID элемента и количества		let itemId = target.getAttribute("data-item-id");		let formQuantity = document.getElementById('cart-quantity'+itemId);		let itemQuantity = formQuantity.value;		let inCart = target.getAttribute("data-in-cart");		target.innerHTML = '<i class="uk-icon-refresh uk-icon-spin"></i>';		let xhr = new XMLHttpRequest();		let body = '';		let task = '';		if (itemQuantity === '0') { // Удаляем			body = 'item_id='+itemId;			task = 'index.php?option=com_lscart&task=cart.delete';		}		else {  // Изменяем            body = 'item_id='+itemId+'&item_quantity='+itemQuantity;			task = 'index.php?option=com_lscart&task=cart.add';		}		xhr.open("POST", task, true);		xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');		xhr.send(body);		xhr.onreadystatechange = function() {			if (this.readyState !== 4) {				return;			}			if (xhr.status !== 200) {				alert(xhr.status + ': ' + xhr.statusText);			}			else {				//Кнопка - target				target.setAttribute("data-in-cart", itemQuantity);				if (itemQuantity === '0') { //Удаляем					target.innerHTML = 'В корзину';				}				else {  // Изменяем					target.innerHTML = 'Изменить';				}				//Уже в корзине- cartAlready				let cartAlready = document.getElementById('cart-already'+itemId);				if (itemQuantity === '0') { // Удаляем					cartAlready.hidden = true;				}				else {  // Изменяем					cartAlready.lastChild.textContent = formQuantity.value;                    cartAlready.hidden = false;				}				//Модуль корзины				let cartCount = Number(document.getElementById('cart-count').textContent);				if (itemQuantity === '0') {					document.getElementById('cart-count').textContent = String(cartCount - 1);				}				else {					if (inCart === '0') {   // Это новый элемент в корзине						document.getElementById('cart-count').textContent = String(cartCount + 1);					}				}				//Количество- itemQuantity, определено выше				if (itemQuantity === '0') { // Удаляем					document.getElementById('cart-quantity'+itemId).value = 1;					document.getElementById('cart-quantity'+itemId).setAttribute('min', '1');				}				else {  // Изменяем					document.getElementById('cart-quantity'+itemId).value = 0;					document.getElementById('cart-quantity'+itemId).setAttribute('min', '0');				}			}		}	}		function yaCounter(event) {        if (typeof <?= $item->yaCounter;?> !== "undefined" && <?= $item->yaCounter;?> !== null) {            <?= $item->yaCounter;?>.reachGoal('<?= $item->yaCounterGoal;?>');        }    }</script>